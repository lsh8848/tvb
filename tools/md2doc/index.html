<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown è½¬ Word</title>
  <!-- è®¾ç½® favicon.ico -->
  <link rel="icon" href="https://tvb.zyh520.tk/img/favicon.ico" type="image/x-icon">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
      padding: 10px;
    }
    ã€‚container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
      font-family: 'Consolas', monospace;
      font-size: 14px;
    }
    ã€‚buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    button {
      flex: 1 1 calc(33.33% - 20px);
      padding: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      color: #fff;
      transition: background-color 0.3s ease;
    }
    button:hover {
      opacity: 0.9;
    }
    #openFileButton { background-color: #4CAF50; } /* ç»¿è‰² */
    #clearButton { background-color: #FF5722; }   /* æ©™çº¢è‰² */
    #removeEmptyLinesButton { background-color: #03A9F4; } /* è“è‰² */
    #convertButton { background-color: #FFC107; } /* é»„è‰² */
    #copyButton { background-color: #2196F3; }    /* æ·±è“è‰² */
    #downloadButton { background-color: #E91E63; }/* ç²‰çº¢è‰² */
    .drop-zone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    .drop-zone.dragover {
      border-color: #000;
    }
    #output {
      border: 1px solid #ccc;
      padding: 10px;
      min-height: 200px;
      border-radius: 4px;
      background-color: #f9f9f9;
    }
    
    /* è¡¨æ ¼æ ·å¼ */
    #output table {
      border-collapse: collapse;
      width: 100%;
      margin: 15px 0;
      font-family: Arial, sans-serif;
    }
    
    #output table th,
    #output table td {
      border: 1px solid #ddd;
      padding: 8px 12px;
      text-align: left;
    }
    
    #output table th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    
    #output table tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    
    #output table tr:hover {
      background-color: #f5f5f5;
    }
    
    /* å…¶ä»–æ ·å¼ä¼˜åŒ– */
    #output h1, #output h2, #output h3, #output h4, #output h5, #output h6 {
      margin-top: 20px;
      margin-bottom: 10px;
      color: #333;
    }
    
    #output p {
      margin: 10px 0;
      line-height: 1.6;
    }
    
    #output ul, #output ol {
      margin: 10px 0;
      padding-left: 30px;
    }
    
    #output li {
      margin: 5px 0;
    }
    
    #output code {
      background-color: #f4f4f4;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'Consolas', monospace;
    }
    
    #output pre {
      background-color: #f8f8f8;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      overflow-x: auto;
      margin: 15px 0;
    }
    
    #output pre code {
      background: none;
      padding: 0;
    }
    
    .example-section {
      margin-top: 20px;
      padding: 15px;
      background-color: #f0f8ff;
      border-left: 4px solid #2196F3;
      border-radius: 4px;
    }
    
    .example-section h3 {
      margin-top: 0;
      color: #1976D2;
    }
    
    .example-code {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 10px;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="text-align: center;">Markdown è½¬ Word (ä¼˜åŒ–ç‰ˆ)</h1>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <textarea id="markdownInput" placeholder="åœ¨è¿™é‡Œç²˜è´´ Markdown å†…å®¹..."></textarea>

    <!-- æ‹–æ‹½åŒºåŸŸ -->
    <div class="drop-zone" id="dropZone">æ‹–æ‹½ Markdown æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>

    <!-- æŒ‰é”® -->
    <div class="buttons">
      <button id="openFileButton">æ‰“å¼€æ–‡ä»¶</button>
      <button id="clearButton">æ¸…ç©ºå†…å®¹</button>
      <button id="removeEmptyLinesButton">åˆ é™¤ç©ºè¡Œ</button>
      <button id="convertButton">è½¬æ¢ Word</button>
      <button id="copyButton">å¤åˆ¶å†…å®¹</button>
      <button id="downloadButton">ä¸‹è½½ Word</button>
    </div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† -->
    <input type="file" id="fileInput" accept=".md,.txt" style="display: none;">

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <div id="output" contenteditable="true">è½¬æ¢åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    
    <!-- ç¤ºä¾‹è¯´æ˜ -->
    <div class="example-section">
      <h3>ğŸ“‹ æ”¯æŒçš„ Markdown è¯­æ³•</h3>
      <p><strong>è¡¨æ ¼è¯­æ³•ç¤ºä¾‹ï¼š</strong></p>
      <div class="example-code">| åˆ—1 | åˆ—2 | åˆ—3 |
|-----|-----|-----|
| å†…å®¹1 | å†…å®¹2 | å†…å®¹3 |
| å†…å®¹4 | å†…å®¹5 | å†…å®¹6 |</div>
      
      <p><strong>å…¶ä»–æ”¯æŒçš„è¯­æ³•ï¼š</strong></p>
      <ul>
        <li><strong>æ ‡é¢˜ï¼š</strong> # ## ### #### ##### ######</li>
        <li><strong>ç²—ä½“ï¼š</strong> **æ–‡æœ¬**</li>
        <li><strong>æ–œä½“ï¼š</strong> *æ–‡æœ¬*</li>
        <li><strong>æ— åºåˆ—è¡¨ï¼š</strong> - * + (æ”¯æŒåµŒå¥—)</li>
        <li><strong>æœ‰åºåˆ—è¡¨ï¼š</strong> 1. 2. 3. (æ”¯æŒåµŒå¥—)</li>
        <li><strong>é“¾æ¥ï¼š</strong> [æ–‡æœ¬](URL)</li>
        <li><strong>è¡Œå†…ä»£ç ï¼š</strong> `ä»£ç `</li>
        <li><strong>ä»£ç å—ï¼š</strong> ```ä»£ç ```</li>
        <li><strong>åˆ†å‰²çº¿ï¼š</strong> --- (è½¬æ¢ä¸ºç©ºè¡Œ)</li>
        <li><strong>è¡¨æ ¼ï¼š</strong> | åˆ—1 | åˆ—2 | (æ”¯æŒå¯¹é½)</li>
      </ul>
    </div>
  </div>

  <!-- å¼•å…¥ FileSaver.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
    const markdownInput = document.getElementById('markdownInput');
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const openFileButton = document.getElementById('openFileButton');
    const clearButton = document.getElementById('clearButton');
    const removeEmptyLinesButton = document.getElementById('removeEmptyLinesButton');
    const convertButton = document.getElementById('convertButton');
    const copyButton = document.getElementById('copyButton');
    const downloadButton = document.getElementById('downloadButton');
    const output = document.getElementById('output');

    // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        markdownInput.value = e.target.result;
        // è‡ªåŠ¨è½¬æ¢
        convertMarkdown();
      };
      reader.readAsText(file);
    }

    // æ‹–æ‹½åŠŸèƒ½
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    dropZone.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) handleFile(file);
    });

    openFileButton.addEventListener('click', () => {
      fileInput.click();
    });

    // æ¸…ç©ºå†…å®¹
    clearButton.addEventListener('click', () => {
      markdownInput.value = '';
      output.innerHTML = 'è½¬æ¢åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
    });

    // åˆ é™¤ç©ºç™½è¡Œï¼ˆé’ˆå¯¹è¾“å…¥æ¡†ä¸­çš„ Markdown æ–‡æœ¬ï¼‰
    removeEmptyLinesButton.addEventListener('click', () => {
      markdownInput.value = markdownInput.value.replace(/^\s*[\r\n]/gm, '');
    });

    // å¤„ç†è¡¨æ ¼çš„å‡½æ•°
    function parseTable(text) {
      const lines = text.split('\n');
      let result = '';
      let i = 0;
      
      while (i < lines.length) {
        const line = lines[i].trim();
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯è¡¨æ ¼è¡Œï¼ˆåŒ…å« | ç¬¦å·ï¼‰
        if (line.includes('|') && line.length > 0) {
          let tableHtml = '<table>';
          let isFirstRow = true;
          
          // å¤„ç†è¡¨æ ¼è¡Œ
          while (i < lines.length && lines[i].trim().includes('|')) {
            const currentLine = lines[i].trim();
            
            // è·³è¿‡åˆ†éš”è¡Œï¼ˆå¦‚ |-----|-----|ï¼‰
            if (/^\|[\s\-\|:]*\|?$/.test(currentLine)) {
              i++;
              continue;
            }
            
            // è§£æè¡¨æ ¼å•å…ƒæ ¼
            const cells = currentLine.split('|')
              .map(cell => cell.trim())
              .filter((cell, index, array) => {
                // ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„ç©ºå•å…ƒæ ¼
                return !(index === 0 && cell === '') && !(index === array.length - 1 && cell === '');
              });
            
            if (cells.length > 0) {
              const tag = isFirstRow ? 'th' : 'td';
              tableHtml += '<tr>';
              
              cells.forEach(cell => {
                // å¤„ç†å•å…ƒæ ¼å†…çš„ Markdown è¯­æ³•
                let processedCell = cell;
                processedCell = processedCell.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                processedCell = processedCell.replace(/\*(.*?)\*/g, '<i>$1</i>');
                processedCell = processedCell.replace(/`([^`]+)`/g, '<code>$1</code>');
                processedCell = processedCell.replace(/\[(.*?)\]\((.*?)\)/g, "<a href='$2'>$1</a>");
                
                tableHtml += `<${tag}>${processedCell}</${tag}>`;
              });
              
              tableHtml += '</tr>';
              isFirstRow = false;
            }
            
            i++;
          }
          
          tableHtml += '</table>';
          result += tableHtml + '\n';
        } else {
          result += lines[i] + '\n';
          i++;
        }
      }
      
      return result;
    }

    // å¢å¼ºç‰ˆ Markdown è½¬ HTML å‡½æ•°ï¼ˆæ·»åŠ è¡¨æ ¼æ”¯æŒï¼‰
    function markdownToHtml(markdown) {
      // é¦–å…ˆå¤„ç†è¡¨æ ¼
      markdown = parseTable(markdown);
      
      // é¦–å…ˆå¤„ç†é•¿åˆ’çº¿ --- è½¬æ¢ä¸ºç©ºè¡Œ
      markdown = markdown.replace(/^---+$/gim, '<br>');
      
      // è½¬æ¢æ ‡é¢˜
      markdown = markdown.replace(/^###### (.*$)/gim, '<h6>$1</h6>');
      markdown = markdown.replace(/^##### (.*$)/gim, '<h5>$1</h5>');
      markdown = markdown.replace(/^#### (.*$)/gim, '<h4>$1</h4>');
      markdown = markdown.replace(/^### (.*$)/gim, '<h3>$1</h3>');
      markdown = markdown.replace(/^## (.*$)/gim, '<h2>$1</h2>');
      markdown = markdown.replace(/^# (.*$)/gim, '<h1>$1</h1>');
      
      // ç²—ä½“
      markdown = markdown.replace(/\*\*(.*?)\*\*/gim, '<b>$1</b>');
      
      // æ–œä½“
      markdown = markdown.replace(/\*(.*?)\*/gim, '<i>$1</i>');
      
      // é“¾æ¥
      markdown = markdown.replace(/\[(.*?)\]\((.*?)\)/gim, "<a href='$2'>$1</a>");
      
      // è¡Œå†…ä»£ç 
      markdown = markdown.replace(/`([^`]+)`/gim, '<code>$1</code>');
      
      // å¤šè¡Œä»£ç å— ```...```
      markdown = markdown.replace(/```([\s\S]*?)```/gim, '<pre><code>$1</code></pre>');
      
      // å¤„ç†åˆ—è¡¨(æ”¯æŒç¼©è¿›å’Œä¸åŒç¬¦å·)
      markdown = parseLists(markdown);
      
      // æ®µè½ (æ’é™¤å·²ç»è¢«å¤„ç†çš„æ ‡ç­¾)
      markdown = markdown.replace(/^(?!<[hlu\/]|<br>|<pre>|<table)(\S.*?)$/gim, '<p>$1</p>');
      
      return markdown;
    }

    // å¢å¼ºç‰ˆåˆ—è¡¨å¤„ç†å‡½æ•° - æ”¯æŒæ— åºåˆ—è¡¨çš„ -, *, + å’Œæœ‰åºåˆ—è¡¨
    function parseLists(text) {
      const lines = text.split('\n');
      let result = '';
      const stack = []; // ä¿å­˜ç¼©è¿›çº§åˆ«å¯¹åº”çš„åˆ—è¡¨ç±»å‹å’Œæ ‡ç­¾
      
      lines.forEach(line => {
        // åŒ¹é…æ— åºåˆ—è¡¨: -, *, +
        const unorderedMatch = /^(\s*)[-*+] (.*)/.exec(line);
        // åŒ¹é…æœ‰åºåˆ—è¡¨: 1. 2. 3. ç­‰
        const orderedMatch = /^(\s*)(\d+)\. (.*)/.exec(line);
        
        if (unorderedMatch || orderedMatch) {
          const isOrdered = !!orderedMatch;
          const match = unorderedMatch || orderedMatch;
          const indent = match[1].length; // ç¼©è¿›ç©ºæ ¼æ•°
          const content = isOrdered ? match[3].trim() : match[2].trim();
          
          // å½“å‰ç¼©è¿›å±‚çº§ (çº¦å®š 2-4 ç©ºæ ¼ = 1 å±‚)
          let level = Math.floor(indent / 2);
          
          // å¦‚æœéœ€è¦è¿›å…¥æ›´æ·±å±‚æ¬¡
          while (stack.length <= level) {
            const listType = isOrdered ? 'ol' : 'ul';
            result += `<${listType}>`;
            stack.push(listType);
          }
          
          // å¦‚æœå›é€€å±‚çº§
          while (stack.length > level + 1) {
            const listType = stack.pop();
            result += `</${listType}>`;
          }
          
          // å¦‚æœå½“å‰å±‚çº§çš„åˆ—è¡¨ç±»å‹ä¸åŒ¹é…ï¼Œéœ€è¦å…³é—­å¹¶é‡æ–°å¼€å¯
          if (stack.length > 0) {
            const currentType = isOrdered ? 'ol' : 'ul';
            if (stack[stack.length - 1] !== currentType) {
              const oldType = stack.pop();
              result += `</${oldType}>`;
              result += `<${currentType}>`;
              stack.push(currentType);
            }
          }
          
          result += `<li>${content}</li>`;
        } else {
          // å…³é—­æ‰€æœ‰æœªé—­åˆçš„åˆ—è¡¨
          while (stack.length > 0) {
            const listType = stack.pop();
            result += `</${listType}>`;
          }
          result += line + '\n';
        }
      });
      
      // å…³é—­æ‰€æœ‰æœªé—­åˆçš„åˆ—è¡¨
      while (stack.length > 0) {
        const listType = stack.pop();
        result += `</${listType}>`;
      }
      
      return result;
    }

    // è½¬æ¢å‡½æ•°
    function convertMarkdown() {
      const markdown = markdownInput.value;
      const htmlContent = markdownToHtml(markdown);
      output.innerHTML = htmlContent;
    }
    
    // è½¬æ¢æŒ‰é’®
    convertButton.addEventListener('click', convertMarkdown);

    // å®æ—¶è½¬æ¢åŠŸèƒ½
    markdownInput.addEventListener('input', convertMarkdown);

    // å¤åˆ¶æŒ‰é’®
    copyButton.addEventListener('click', () => {
      const range = document.createRange();
      range.selectNodeContents(output);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      document.execCommand('copy');
      selection.removeAllRanges();
      alert('å·²å¤åˆ¶è½¬æ¢åçš„å†…å®¹åˆ°å‰ªè´´æ¿ï¼');
    });

    // ä¸‹è½½ä¸º Word æ–‡ä»¶
    downloadButton.addEventListener('click', () => {
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>æ–‡æ¡£</title>
          <style>
            @page {
              margin: 2.54cm 2.54cm 2.54cm 2.54cm;
            }
            body { 
              font-family: "Times New Roman", serif; 
              line-height: 1.6; 
              margin: 0; 
              padding: 0;
              width: 100%;
            }
            h1, h2, h3, h4, h5, h6 { margin-top: 20px; margin-bottom: 10px; font-weight: bold; }
            p { margin: 10px 0; }
            ul, ol { margin: 10px 0; padding-left: 30px; }
            li { margin: 5px 0; }
            table { 
              border-collapse: collapse; 
              width: 100%; 
              margin: 15px 0; 
              table-layout: fixed;
            }
            th, td { 
              border: 1px solid #000; 
              padding: 8px; 
              text-align: left; 
              word-wrap: break-word;
              vertical-align: top;
            }
            th { background-color: #f2f2f2; font-weight: bold; }
            code { background-color: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
            pre { 
              background-color: #f8f8f8; 
              border: 1px solid #ddd; 
              padding: 10px; 
              margin: 15px 0;
              white-space: pre-wrap;
              word-wrap: break-word;
            }
            pre code { background: none; padding: 0; }
            a { color: #0066cc; text-decoration: underline; }
            b { font-weight: bold; }
            i { font-style: italic; }
            
            /* Word ç‰¹å®šæ ·å¼ */
            * {
              box-sizing: border-box;
            }
            
            /* ç¡®ä¿å†…å®¹ä¸ä¼šæº¢å‡ºé¡µé¢ */
            div, p, table, pre {
              max-width: 100%;
            }
          </style>
        </head>
        <body>
          ${output.innerHTML}
        </body>
        </html>
      `;
      const blob = new Blob([htmlContent], { type: 'application/msword' });
      saveAs(blob, 'æ–‡æ¡£.doc');
    });

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è½¬æ¢ç¤ºä¾‹
    window.addEventListener('load', () => {
      convertMarkdown();
    });
  </script>
</body>
</html>
